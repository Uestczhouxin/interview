# Redis

## 架构

单进程单线程，通过epoll实现多路I/O复用，节省上下文切换资源时间（相较内存操作时间较长）

## 特点

### 数据类型

支持字符串（string）、散列（hash）、列表（list）、集合（set）、有序集合（sorted set）等

Redis 内部使用一个 redisObject 对象来表示所有的 key 和 value

![](https://pics6.baidu.com/feed/023b5bb5c9ea15ce598be46bdbb071f53b87b2a5.jpeg?token=3f5ccd21917fb33a2472bbb06b480a56&s=5AA834629B8961495EFDB0C70000E0B1)

redisObject 最主要的信息如上图所示：type 表示一个 value 对象具体是何种数据类型，encoding 是不同数据类型在 Redis 内部的存储方式。

### 持久化

RDB：快照形式是直接把内存中的数据保存到一个 dump 的文件中，定时保存，保存策略。

AOF：把所有的对 Redis 的服务器进行修改的命令都存到一个文件里，命令的集合。

Redis 默认是快照 RDB 的持久化方式。当 Redis 重启的时候，它会优先使用 AOF 文件来还原数据集，因为 AOF 文件保存的数据集通常比 RDB 文件所保存的数据集更完整。

### 淘汰策略

![](https://pics5.baidu.com/feed/6a600c338744ebf83ba823bbb4499c2c6259a78b.png?token=5cbb06d988031e4681b6e2d452889748&s=11A07D3205CA454B4A54A4CE0000C0B2)

## 应用场景

数据量较小的更性能操作和运算上

# Memcached

## 架构

单进程多线程，可以利用多核优势，单实例吞吐量极高

## 特点

只支持简单的key/value数据结构，不像Redis可以支持丰富的数据类型。

无法进行持久化，数据不能备份，只能用于缓存使用，且重启后数据全部丢失。

## 应用场景

用于在动态系统中减少数据库负载，提升性能;做缓存，提高性能，适合读多写少

# redis与memcached区别

1. 内存管理机制
   Memecache把数据全部存在内存之中，断电后会挂掉，数据不能超过内存大小。在Redis中，并不是所有的数据都一直存储在内存中的。当物理内存用完时，Redis可以将一些很久没用到的value交换到磁盘。Redis支持通过RDB与AOF的方式保存数据实现数据持久化。

2. 数据操作不同
   Redis支持多种数据类型，如string、list、sort、hash等，Memcached只支持简单key-value结构的数据

3. 性能不同
   由于Redis只使用单核，而Memcached可以使用多核，所以平均每一个核上Redis在存储小数据时比Memcached性能更高。而在100k以上的数据中，Memcached性能要高于Redis

4. 集群管理不同
   Memcached本身并不支持分布式，因此只能在客户端通过像一致性哈希这样的分布式算法来实现Memcached的分布式存储。相较于Memcached只能采用客户端实现分布式存储，Redis更偏向于在服务器端构建分布式存储。

# 缓存雪崩、缓存穿透、缓存穿刺
## 缓存雪崩
### 原因
大量缓存同时失效，流量达到DB中，导致系统崩溃
### 解决
批量往 Redis 存数据的时候，把每个 Key 的失效时间都加个随机值就好了，这样可以保证数据不会再同一时间大面积失效
## 缓存穿透
### 原因
指缓存和数据库中都没有的数据，而用户（黑客）不断发起请求。
### 解决
* 查询不存在数据时存储一个空值，并设置过期时间（会生成大量无效缓存key）
* 布隆过滤器，预先录入存在数据key（会出现不存在数据的误判，需设置bitmap大小以及hash次数）
## 缓存穿刺
### 原因
热点数据失效，大量流量同时打到DB
### 解决
热点数据永不失效
# Mongodb

## 特点

mongoDB 是一种文档性的数据库。

mongodb与mysql不同，mysql的每一次更新操作都会直接写入硬盘，但是mongo不会，做为内存型数据库，数据操作会先写入内存，然后再会持久化到硬盘中去。

关系型数据库采用的结构化的数据，NoSQL采用的是键值对的方式存储数据。

在处理非结构化/半结构化的大数据时；在水平方向上进行扩展时；随时应对动态增加的数据项时可以优先考虑使用NoSQL数据库。

## 持久化

binlog

## 应用场景

解决海量数据的访问效率问题